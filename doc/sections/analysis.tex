

\chapter{Systemanalyse}

In diesem Kapitel wird analysiert, wie sich das umzusetzende System in unterschiedlichen Situationen und gegenüber anderen Systemen verhalten muss.
Um eine Gesamtübersicht über das System zu erhalten, wird zuerst ein Systemkontextdiagramm und Anwendungsfalldiagramme aufgezeigt, daraufhin eine Nachrichtenanalyse und eine Schnittstellenanalyse durchgeführt.

%\todo{..}
%Systemkontextdiagramme \cite[501]{goll2012methoden}


\section{Systemkontextdiagramm}
\label{system_context}

%In der folgenden Abbildung sind die Systemgrenzen aufgezeigt.

In \autoref{system_context_diagramm} ist das System \enquote{MEC-View Server} abgebildet.
Die Pfeile zeigen Kontroll- und Datenflüsse auf andere  Systeme, mit denen eine wechselwirkung stattfindet \cite[501]{goll2012methoden}.

\begin{figure}[H]
	\begin{tikzpicture}[node distance=5,scale=0.8, every node/.style={transform shape}]
		\node [draw, rectangle, drop shadow, fill=white] (F) {Fahrzeug};
		\node [draw, circle, drop shadow, fill=white, text width=3cm, align=center] (C) [below right=of F] {MEC-View Server};
		\node [draw, rectangle, drop shadow, fill=white] (S) [below right=of C] {Sensor};
%		\node [draw, rectangle, drop shadow, fill=white] (A) [above right=of C] {Fusionsalgorithmus};
		
		\node (ctrl1) [above=of S] {};
		\node (ctrl2) [above right=of C] {};
		\node (ctrl3) [right=of C] {};
		\node (ctrl4) [below=of F] {};
		\node (ctrl5) [left=of C] {};
		\node (ctrl6) [below=of ctrl5] {};
		\node (ctrl7) [above=of C] {};
		\node (ctrl8) [right=of F] {};
		
		%
		% Fahrzeug -> MEC-View-Server
		%
		\path[draw, -{Latex[scale=2.0]}, dashed] (F)
				edge [bend right] node [fill=white] {deabonnieren} (C)
				edge [bend left]  node [fill=white] {abonnieren} (C)
				.. controls (ctrl7) and (ctrl8) ..  node [fill=white] {Als Fahrzeug registrieren} (C);
				
		%
		% MEC-View-Server -> Fahrzeug
		%
		\path[draw, -{Latex[scale=2.0]}] (C)
				edge node [fill=white] {EnvironmentFrame} (F)
				.. controls (ctrl4) and (ctrl5) ..  node [fill=white] {Sektoren} (F);
				
		%
		% MEC-View-Server -> Algorithmus
		%
%		\path[draw, -{Latex[scale=2.0]}] (C)
%				edge [bend right] node [fill=white] {SensorFrame} (A);
		
		%
		% Algorithmus -> MEC-View-Server
		%
%		\path[draw, -{Latex[scale=2.0]}] (A)
%				edge [bend right] node [fill=white] {EnvironmentFrame} (C);
		
		%
		% Sensor -> MEC-View-Server
		%		
		\path[draw, -{Latex[scale=2.0]}, dashed] (S)
			.. controls (ctrl3) and (ctrl1) ..  node [fill=white] {Als Sensor registrieren} (C);
			
		\path[draw, -{Latex[scale=2.0]}] (S)
			edge node [fill=white] {Sensor(Idle)Frame} (C);
				
		%
		% MEC-View-Server -> Sensor
		%
		\path[draw, -{Latex[scale=2.0]}, dashed] (C)
			edge [bend left]  node [fill=white] {abonnieren} (S)
			edge [bend right] node [fill=white] {deabonnieren} (S);
			
				
				
		
		\path[draw, -{Latex[scale=2.0]}] (4, -8) -- (.5, -8) node [pos=.5, above] {Datenfluss};
		\path[draw, -{Latex[scale=2.0]}, dashed] (4, -9) -- (.5, -9) node [pos=.5, above] {Kontrollfluss};
			
		%\umlinherit{F}{L}
		%\umlinherit{S}{L}
	\end{tikzpicture}
	\centering
	\caption{Systemkontextdiagramm}
	\label{system_context_diagramm}
\end{figure}


\section{Gesamtübersicht der Anwendungsfälle}

In diesem Kapitel werden die Kontroll- und Datenflüsse aus \autoref{system_context} genauer analysiert.
Aufgrund des Umfangs ist dies in zwei Anwendungsfalldiagramme aufgeteilt.

\begin{figure}[H]
	\scalebox{.65}{\begin{tikzpicture}[node distance=5]
		\begin{umlsystem}{MEC-View-Server}
%			\umlusecase[y=4,name=u0]{Verbindung aufbauen}
			\umlusecase[y=2,name=u3]{Als Fahrzeug registrieren}
			\umlusecase[y=0,name=u1]{Umgebungsmodell abonnieren}
			\umlusecase[y=-2,name=u2]{Umgebungsmodell deabonnieren}
			\umlusecase[y=-4,name=u9]{Fahrzeug Sektoren zusenden}
			\umlusecase[y=-6,name=u10]{Fahrzeug Umgebungsmodell zusenden}
%			\umlusecase[y=-4,name=u4]{Umfeldmodel übergeben}
		\end{umlsystem}
		\umlactor[x=-9.5,y=-2]{Fahrzeug}
		\umlassoc{Fahrzeug}{u1}
		\umlassoc{Fahrzeug}{u2}
		\umlassoc{Fahrzeug}{u3}
		\umlassoc{Fahrzeug}{u9}
		\umlassoc{Fahrzeug}{u10}
	\end{tikzpicture}}
	\centering
	\caption{Anwendungsfalldiagramm des MEC-View-Servers für den Akteur \enquote{Fahrzeug}}
	\label{use_case:car}
\end{figure}

Das Anwendungsfalldiagramm in \autoref{use_case:car} zeigt die Funktionalität des Servers, die gegenüber einem Fahrzeug zur Verfügung gestellt werden soll.
Das folgende Anwendungsfalldiagramm in \autoref{use_case:sensor} zeigt dagegen die Funktionalität, die einem Sensor zur Verfügung gestellt werden soll.

\begin{figure}[H]
	\scalebox{.65}{\begin{tikzpicture}[node distance=5]
	\begin{umlsystem}{MEC-View-Server}
	\umlusecase[y=-4,name=u4]{Als Sensor registrieren}
	\umlusecase[y=-6,name=u5]{SensorFrame zusenden}
	\umlusecase[y=-8,name=u6]{SensorIdleFrame zusenden}
	\umlusecase[y=-10,name=u7]{Sensor abonnieren}
	\umlusecase[y=-12,name=u8]{Sensor deabonnieren}
	\end{umlsystem}
	\umlactor[x=-9.5,y=-8]{Sensor}
	\umlassoc{Sensor}{u4}
	\umlassoc{Sensor}{u5}
	\umlassoc{Sensor}{u6}
	\umlassoc{Sensor}{u7}
	\umlassoc{Sensor}{u8}
	%		\umlassoc{Fusionsalgorithmus}{u4}
	\end{tikzpicture}}
	\centering
	\caption{Anwendungsfalldiagramm des MEC-View-Servers für den Aktuer \enquote{Sensor}}
	\label{use_case:sensor}
\end{figure}


\clearpage
\section{Beschreibung der Anwendungsfälle}

Die einzelnen Anwendungsfälle aus \autoref{use_case:car} und \autoref{use_case:sensor} sollen in diesem Kapitel genauer erklärt werden.

\newcommand{\usecasetablewidth}{11.5cm}
\newcommand{\usecase}[7]{\subsection{#1}
	\begin{tabular}[H]{lp{\usecasetablewidth}}
		\textbf{Initiator:} & #2 \\
		\textbf{Beteiligte Akteure:} & #3 \\
		\textbf{Vorbedingung:} & #4 \\
		\textbf{Basisablauf:} & #5 \\
		\textbf{Alternativablauf:} & #6 \\
		\textbf{Nachbedingung:} & #7 \\
	\end{tabular}
}
\newcommand{\usecaseWT}[8]{\subsection{#1}
	\begin{tabular}[H]{lp{\usecasetablewidth}}
		\textbf{Initiator:} & #2 \\
		\textbf{Auslöser:} & #3 \\
		\textbf{Beteiligte Akteure:} & #4 \\
		\textbf{Vorbedingung:} & #5 \\
		\textbf{Basisablauf:} & #6 \\
		\textbf{Alternativablauf:} & #7 \\
		\textbf{Nachbedingung:} & #8 \\
	\end{tabular}
}

\usecase{Als Fahrzeug registrieren}
	{Fahrzeug}
	{Fahrzeug}
	{Noch nicht registriert}
	{Ein neu verbundenes Fahrzeug kann sich dem Server gegenüber als Fahrzeug registrieren.
		Eine Registrierung kann für jede Verbindung  nur einmal vorgenommen werden und wird durch die Übermittlung einer \textit{ClientRegistration}-Nachricht durchgeführt (siehe \autoref{msg:client_registration}).}
	{--}
	{Das Fahrzeug kann alle weiteren, dem Fahrzeug zugeordneten, Use-Cases ausführen.}

\usecase{Umgebungsmodell abonnieren}
	{Fahrzeug}
	{Fahrzeug}
	{Ist als Fahrzeug registriert}
	{Ein Fahrzeug kann das Umgebungsmodell abonnieren, woraufhin neue Modelle vom Server an das Fahrzeug übermittelt werden.
		Ein Abonnement wird durch eine \textit{UpdateSubscription}-Nachricht aktualisiert (siehe \autoref{msg:update_subscription}).}
	{--}
	{Neue Umgebungsmodelle werden an das Fahrzeug übermittelt.}
	
	
\usecase{Umgebungsmodell deabonnieren}
	{Fahrzeug}
	{Fahrzeug}
	{Umgebungsmodell ist abonniert}
	{Ein Fahrzeug kann das Umgebungsmodell deabonnieren, woraufhin keine neuen Modelle mehr vom Server an das Fahrzeug übermittelt werden.
		Ein Abonnement wird durch eine \textit{UpdateSubscription}-Nachricht aktualisiert (siehe \autoref{msg:update_subscription}).}
	{--}
	{Es werden keine weiteren Umgebungsmodelle an das Fahrzeug übermittelt.}

\usecase{Als Sensor registrieren}
	{Sensor}
	{Sensor}
	{Noch nicht registriert}
	{Ein neu verbundener Sensor kann sich dem Server gegenüber als Sensor registrieren.
		Eine Registrierung kann für jede Verbindung nur einmal vorgenommen werden und wird durch die Übermittlung einer \textit{ClientRegistration}-Nachricht durchgeführt (siehe \autoref{msg:client_registration}).}
	{--}
	{Der Sensor kann alle weiteren, dem Sensor zugeordneten, Use-Cases ausführen.}

\usecase{SensorFrame zusenden}
	{Sensor}
	{Sensor}
	{Ist als Sensor registriert}
	{Ein Sensor kann dem Server eine \textit{SensorFrame}-Nachricht übermitteln.
		Der Server soll diese Nachricht dem Fusionsalgorithmus weiterleiten.}
	{--}
	{--}

\usecase{SensorIdleFrame zusenden}
	{Sensor}
	{Sensor}
	{Ist als Sensor registriert, Sensor ist nicht abonniert.}
	{Ein Sensor kann dem Server eine \textit{SensorIdleFrame}-Nachricht übermitteln.}
	{--}
	{--}
	

\usecaseWT{Sensor abonnieren}
	{MEC-View-Server}
	{Ein Fahrzeug hat sich registriert.}
	{Sensor}
	{Ist als Sensor registriert}
	{Der MEC-View-Server sendet eine \textit{UpdateSubscription}-Nachricht (siehe \autoref{msg:update_subscription}), um ein Abonnement zu erstellen.}
	{--}
	{Der MEC-View-Server erhält \textit{SensorFrame}-Nachrichten und keine \textit{SensorIdleFrame}-Nachrichten.}
	
\usecaseWT{Sensor deabonnieren}
	{MEC-View-Server}
	{Das letzte verbundene Fahrzeug hat die Verbindung getrennt.}
	{Sensor}
	{Ist als Sensor registriert}
	{Der MEC-View-Server sendet eine \textit{UpdateSubscription}-Nachricht (siehe \autoref{msg:update_subscription}), um ein Abonnement zu beenden.}
	{--}
	{Der MEC-View-Server erhält keine weiteren \textit{SensorFrame}-Nachrichten, jedoch \textit{SensorIdleFrame}-Nachrichten.}
	


\usecaseWT{Fahrzeug Sektoren zusenden}
	{MEC-View-Server}
	{Das Fahrzeug hat eine \textit{ClientRegistration}-Nachricht gesendet.}
	{Fahrzeug}
	{Ist als Fahrzeug registriert, Sektoren noch nicht übermittelt}
	{Der MEC-View-Server soll dem Fahrzeug einmalig nach Registrierung alle bekannten Sektoren in einer \textit{InitMessage}-Nachricht (siehe \autoref{msg:init_message}) zusenden.}
	{--}
	{Sektoren können nicht erneut zugesendet werden.}
	
\usecaseWT{Fahrzeug Umgebungsmodell zusenden}
	{MEC-View-Server}
	{Der Algorithmus hat ein neues Umgebungsmodell erstellt.}
	{Fahrzeug}
	{Fahrzeug ist abonniert}
	{Der MEC-View-Server kann dem Fahrzeug Umgebungsmodelle mit \textit{EnvironmentFrame}-Nachrichten (siehe \autoref{msg:environment_frame}) zusenden.}
	{--}
	{--}

%\begin{figure}[H]
%	\begin{tikzpicture}[node distance=5]
%		\begin{umlsystem}{Fusionsalgorithmus}
%			\umlusecase[y=0,name=u1]{Sensordaten übergeben}
%		\end{umlsystem} 
%		\umlactor[x=-5,y=0]{MEC-View-Server}
%		\umlassoc{MEC-View-Server}{u1}
%	\end{tikzpicture}
%	\centering
%	\label{use_case:server_algorithmus}
%	\caption{Use Case Diagramm des MEC-View-Servers gegenüber dem Fusionsalgorithmus}
%\end{figure}


\newpage
\section{Nachrichtenanalyse}
\label{analysis:messages}

\begin{wrapfigure}{R}[-1.5em]{.5\textwidth}
	\centering
	\begin{bytefield}[bitwidth=.45em,bitheight=.7em]{32}
		\bitheader{0,31} \\
		
		\begin{rightwordgroup}{Kopf}
			\wordbox{4}{ASN.1 Nachrichtenlänge \textbf{$n$}} \\
			\wordbox{4}{ASN.1 Nachrichtentyp}
		\end{rightwordgroup} \\
		
		\begin{rightwordgroup}{Länge in\\\textbf{$n$} Bytes}
			\wordbox[lrt]{8}{ASN.1 Nachricht} \\
			\skippedwords \\
			\wordbox[lrb]{2}{}
		\end{rightwordgroup}
	\end{bytefield}
	\caption{ASN.1 Nachricht mit Kopfdaten}
	\label{message:structure}
\end{wrapfigure}

Eine ASN.1 Nachricht wird, wie in \autoref{message:structure} zu sehen, mit  vorangestellten Kopfdaten versendet.
Diese Kopfdaten enthalten die Länge der ASN.1 Nachricht und dessen Typ, der bei der Dekodierung beim Empfängers bekannt sein muss.
Die Nachrichtenlänge und der Nachrichtentyp werden als 32-Bit lange und vorzeichenlose Ganzzahlen übermittelt und entsprechen damit dem Datentyp \rustcinline{u32} in Rust.
Sie werden als \enquote{Big-Endian} auf dem Datenstrom dargestellt.

Die Nachrichtenlänge gibt die Länge der ASN.1 Nachricht in Bytes an.

Für den Nachrichtentyp sind nur die in \autoref{message:types} gelisteten Werte gültig und werden im Anschluss erklärt.

\begin{figure}[H]
	\centering
	\begin{tabular}{r|l|l}
		Typ & Nachricht & Aus Sichtweise des Servers \\
		\hline
		0 & \enquote{Nicht definiert} & -- \\
		1 & ClientRegistration & eingehend \\
		2 & SensorFrame & eingehend \\
		3 & EnvironmentFrame & ausgehend \\
		4 & UpdateSubscription & bidirektional \\
		5 & InitMessage & ausgehend \\
		6 & RoadClearanceFrame & ausgehend \\
		7 & SensorIdleFrame & eingehend \\
	\end{tabular}
	\caption{Gültige ASN.1 Nachrichtentypen}
	\label{message:types}
\end{figure}

\subsection{ClientRegistration}
\label{msg:client_registration}

Die ClientRegistration-Nachricht sendet der Client nach dem Verbindungsaufbau dem Server zu, um mitzuteilen, ob es sich um einen Sensor oder ein Fahrzeug handelt.

\subsection{SensorFrame}
\label{msg:sensor_frame}

Die SensorFrame-Nachricht wird vom Sensor an den Server versendet und beschreibt Objekte, die der Sensor erkannt hat.

\subsection{EnvironmentFrame}
\label{msg:environment_frame}

Die EnvironmentFrame-Nachricht wird vom Server an das Fahrzeug versendet und enthält das Ergebnis des Fusionsalgorithmus.

\subsection{UpdateSubscription}
\label{msg:update_subscription}

Die UpdateSubscription-Nachricht wird vom Server an den Sensor oder vom Fahrzeug an den Server gesendet.
Der Server kann sich damit am Sensor an einem SensorFrame-Abonnement anmelden oder abmelden, während das Fahrzeug sich am Server am EnvironmentFrame-Abonnement anmelden oder abmelden kann.

\subsection{InitMessage}
\label{msg:init_message}

Die InitMessage-Nachricht wird vom Server, nach einer Fahrzeuganmeldung, an das Fahrzeug gesendet und beinhaltet Koordinaten über die Sektoren, die die Sensoren beobachten.

\subsection{RoadClearanceFrame}

Die RoadClearanceFrame-Nachricht wird vom Server an das Fahrzeug versendet und kann Verkehrs-, Wetter- und andere Informationen über die Sektoren enthalten.

\subsection{SensorIdleFrame}
\label{msg:sensor_idle_frame}

Die SensorIdleFrame-Nachricht wird vom Sensor in regelmäßigen Zeitintervallen an den Server versendet, wenn der Sensor nicht abonniert ist.
Die Anwesenheit des Sensors wird somit festgestellt.
Für diese Bachelorarbeit ist der Inhalt dieser Nachricht nicht relevant, lediglich ein fehlerfreies dekodieren muss sichergestellt sein.
In der Referenzimplementierung des Forschungsprojekts wird dagegen versucht, mit dieser Nachricht eine Fehlfunktion des Sensors festzustellen.


%\begin{figure}[H]
%	\centering
%	\begin{bytefield}[bitwidth=.25em,bitheight=2em]{128}
%		\bitheader{0,32,64} \\
%		
%		\bitbox{32}{Länge $n$}
%		\bitbox{32}{Nachricht Id}
%		\bitbox{64}{ASN.1 Nachricht der Länge $n$}
%		%		\skippedbits
%		%		\bitbox[tbr]{32}{}
%	\end{bytefield}
%	\caption{Aufbau eines WebSocket-Frames \cite[28]{ieft:websockets}}
%	\label{figure:websockets:frame}
%\end{figure}
%\todo{alternativ:}
%\begin{figure}[H]
%	\centering
%	\begin{tikzpicture}
%		\draw[green!2,fill] (0,0) rectangle (2,-3);
%		\draw[red!6,fill] (2,0) rectangle (6,-3);
%		\draw[green!8,fill] (6,0) rectangle (14,-3);
%		\draw[red!2,fill] (14,0) rectangle (16,-3);
%		
%		\draw[gray!40, very thin] (0,0) -- (16,0);
%		\draw[gray!40, very thin] (0,-2) -- (16,-2);
%		\draw (2,0) -- (14,0);
%		\draw (2,-2) -- (14,-2);
%		\draw[gray!40, very thin] (2,-3) -- (2,0.2);
%		\draw (2,0.5) node {0};
%		\draw (3,-1) node {Länge $n$};
%%		\draw (3,-1.7) node {\rustcinline{u32}};
%		\draw[gray!40, very thin] (4,-2) -- (4,0.2);
%		\draw (4,0.5) node {32};
%		\draw (5,-1) node {Id};
%%		\draw (5,-1.7) node {\rustcinline{u32}};
%		\draw[gray!40, very thin] (6,-3) -- (6,0.2);
%		\draw (6,0.5) node {64};
%		\draw[gray!40, very thin] (14,-3) -- (14,0.2);
%		\draw (14,0.5) node {$64 + n$};
%		\draw (10,-1) node {ASN.1 Nachricht};
%		
%		\draw (4,-2.5) node {Kopf};
%		\draw (10,-2.5) node {Korpus};
%	\end{tikzpicture}
%	\label{message:structure_alt}
%	\caption{Aufbau einer Nachricht auf dem Datenstrom}
%\end{figure}


\section{Schnittstellenanalyse}

In diesem Kapitel werden die Schnittstellen analysiert, über die der MEC-View-Server mit dem Sensor und dem Client kommuniziert.
Für die Darstellung der Kommunikation mittels asynchronen Nachrichten werden Sequenzdiagramme verwendet.
Aktionen in \enquote{loop}-Abschnitten werden so lange wiederholt, bis die erste darauf folgende Aktion eintritt.
In den Diagrammen sind in geschweiften Klammern hinter den Nachrichtentypen für die Erläuterung relevante Attribute mit Namen und Wert aufgeführt.
Unvollständige Aufzählungen sind mit zwei Punkten für irrelevante Attributen abgekürzt.

\subsection{Sensor und MEC-View-Server}

In der folgenden \autoref{seq_dia:sensor} ist die Kommunikation zwischen einem Sensor und dem MEC-View-Server zu sehen.

\begin{figure}[H]
	\begin{tikzpicture}
		\begin{umlseqdiag} 
			\umlactor[x=0,no ddots]{Sensor}
			\umlactor[x=11,no ddots]{MEC-View-Server}
			\begin{umlcall}[dt=4, op={ClientRegistration\{type = sensor, ..\}}, type=asynchron]{Sensor}{MEC-View-Server}
				\begin{umlcall}[dt=5, op={UpdateSubscription\{subscription-status = unsubscribe, ..\}}, type=asynchron]{MEC-View-Server}{Sensor}
				\end{umlcall}
			\end{umlcall}
			
			\begin{umlfragment}[type=loop]
				\begin{umlcall}[dt=7, op={SensorIdleFrame\{..\}}, type=asynchron]{Sensor}{MEC-View-Server}
				\end{umlcall}
			\end{umlfragment}
			
			\begin{umlcall}[dt=7, op={UpdateSubscription\{subscription-status = subscribe, ..\}}, type=asynchron]{MEC-View-Server}{Sensor}
			\end{umlcall}
			
			\begin{umlfragment}[type=loop]
				\begin{umlcall}[dt=7, op={SensorFrame\{..\}}, type=asynchron]{Sensor}{MEC-View-Server}
				\end{umlcall}
			\end{umlfragment}
			
			\begin{umlcall}[dt=7, op={UpdateSubscription\{subscription-status = unsubscribe, ..\}}, type=asynchron]{MEC-View-Server}{Sensor}
			\end{umlcall}
			
			\begin{umlfragment}[type=loop]
				\begin{umlcall}[dt=7, op={SensorIdleFrame\{..\}}, type=asynchron]{Sensor}{MEC-View-Server}
				\end{umlcall}
			\end{umlfragment}
		\end{umlseqdiag}
	\end{tikzpicture}
	\centering
	\caption{Kommunikation zwischen Sensor und MEC-View-Server}
	\label{seq_dia:sensor}
\end{figure}

Nach Verbindungsaufbau versendet der Sensor eine \textit{ClientRegistration}-Nachricht (siehe \autoref{msg:client_registration}), um sich am Server als Sensor zu registrieren.
Der Server beantwortet dies mit einer \textit{UpdateSubscription}-Nachricht (siehe \autoref{msg:update_subscription}) um klarzustellen, dass kein Abonnement gewünscht ist.
Der Sensor versendet darauf folgend in regelmäßigen Abständen \textit{SensorIdleFrame}-Nachrichten (siehe \autoref{msg:sensor_idle_frame}).
Nach unbekannter Zeit kann der Server ein Abonnement erstellen, indem eine entsprechende \textit{UpdateSubscription}-Nachricht versendet wird.
Daraufhin sendet der Sensor dem Server anstatt \textit{SensorIdleFrame}-Nachrichten \textit{SensorFrame}-Nachrichten (siehe \autoref{msg:sensor_frame}) zu, bis dieser das Abonnement mit einer \textit{UpdateSubscription}-Nachricht wieder aufkündigt.

\subsection{Fahrzeug und MEC-View-Server}


In der folgenden \autoref{seq_dia:vehicle} ist die Kommunikation zwischen einem Fahrzeug und dem MEC-View-Server zu sehen.

\begin{figure}[H]
	\begin{tikzpicture}
		\begin{umlseqdiag} 
			\umlactor[x=0,no ddots]{Fahrzeug}
			\umlactor[x=11,no ddots]{MEC-View-Server}
			\begin{umlcall}[dt=4, op={ClientRegistration\{type = vehicle, ..\}}, type=asynchron]{Fahrzeug}{MEC-View-Server}
				\begin{umlcall}[dt=5, op={InitMessage\{..\}}, type=asynchron]{MEC-View-Server}{Fahrzeug}
				\end{umlcall}
			\end{umlcall}
			\begin{umlcall}[dt=5, op={UpdateSubscription\{subscription-status = subscribe, ..\}}, type=asynchron]{Fahrzeug}{MEC-View-Server}
			\end{umlcall}
			\begin{umlfragment}[type=loop] 
				\begin{umlcall}[dt=8, op={EnvironmentFrame\{..\}}, type=asynchron]{MEC-View-Server}{Fahrzeug}
				\end{umlcall}
			\end{umlfragment}
			
			\begin{umlcall}[dt=6, op={UpdateSubscription\{subscription-status = unsubscribe, ..\}}, type=asynchron]{Fahrzeug}{MEC-View-Server}
			\end{umlcall}
		\end{umlseqdiag}
	\end{tikzpicture}
	\centering
	\caption{Kommunikation zwischen Fahrzeug und MEC-View-Server}
	\label{seq_dia:vehicle}
\end{figure}

Nach Verbindungsaufbau versendet das Fahrzeug eine \textit{ClientRegistration}-Nachricht um sich am Server als Fahrzeug zu registrieren.
Der Server beantwortet dies mit einer \textit{InitMessage}-Nachricht (siehe \autoref{msg:init_message}) mit Informationen zu bekannten Sektoren.
Bis das Fahrzeug ein Abonnement mittels einer \textit{UpdateSubscription}-Nachricht erstellt, werden keine weiteren Nachrichten ausgetauscht.
Während eines gültigen Abonnements sendet der Server Umfeldmodelle in \textit{EnvironmentFrame}-Nachrichten (siehe \autoref{msg:environment_frame}) an das Fahrzeug.
Durch eine \textit{UpdateSubscription}-Nachricht kann das Fahrzeug jederzeit das Abonnement aufkündigen und erhält daraufhin keine weiteren \textit{EnvironmentFrame}-Nachrichten.

\subsection{Sensor, Fahrzeug und MEC-View-Server}

In \autoref{seq_dia:both} ist das Zusammenspiel des Sensor aus \autoref{seq_dia:sensor}, des Fahrzeugs aus \autoref{seq_dia:vehicle} und des MEC-View-Servers zu sehen.
Um die Übersichtlichkeit zu wahren, wurden die Nachrichtentypen durch Anweisungen ersetzt.
Es ist zu erkennen, dass der Server bereits ein Abonnement gegenüber dem Sensor erstellt, sobald sich ein Fahrzeug registriert.
Dieses Abonnement ist so lange gültig, wie zumindest ein Fahrzeug verbunden ist.

\vspace*{\fill}
\null

\begin{figure}[H]
	\begin{tikzpicture}[scale=.9]
		\begin{umlseqdiag} 
			\umlactor[x=0,no ddots]{Sensor}
			\umlactor[x=6,no ddots]{MEC-View-Server}
			\umlactor[x=12,no ddots]{Fahrzeug}
			
			
			\begin{umlcall}[dt=5, op={register}, type=asynchron]{Sensor}{MEC-View-Server}
				\begin{umlcall}[dt=5, op={unsubscribe}, type=asynchron]{MEC-View-Server}{Sensor}
				\end{umlcall}
			\end{umlcall}
			
			
			\begin{umlfragment}[type=loop] 
				\begin{umlcall}[dt=6,op={SensorIdleFrame}, type=asynchron]{Sensor}{MEC-View-Server}
				\end{umlcall}
			\end{umlfragment}
			
			\begin{umlcall}[dt=28,op={register}, type=asynchron]{Fahrzeug}{MEC-View-Server}
				\begin{umlcall}[dt=5,op={InitMessage}, type=asynchron]{MEC-View-Server}{Fahrzeug}
				\end{umlcall}
				\begin{umlcall}[dt=0,op={subscribe}, type=asynchron]{MEC-View-Server}{Sensor}
				\end{umlcall}
			\end{umlcall}
			
			\begin{umlfragment}[type=loop] 
				\begin{umlcall}[dt=8, op={SensorFrame}, type=asynchron]{Sensor}{MEC-View-Server}
				\end{umlcall}
			\end{umlfragment}
			
			\begin{umlcall}[dt=14,op={subscribe}, type=asynchron]{Fahrzeug}{MEC-View-Server}
			\end{umlcall}
			
			\begin{umlfragment}[type=loop] 
				\begin{umlcall}[dt=15,op={SensorFrame}, type=asynchron]{Sensor}{MEC-View-Server}
					\begin{umlcall}[dt=2, op={EnvironmentFrame}, type=asynchron]{MEC-View-Server}{Fahrzeug}
					\end{umlcall}
				\end{umlcall}
			\end{umlfragment}
			
			\begin{umlcall}[dt=8,op={unsubscribe}, type=asynchron]{Fahrzeug}{MEC-View-Server}
			\end{umlcall}
			
			
			\begin{umlfragment}[type=loop] 
				\begin{umlcall}[dt=15, op={SensorFrame}, type=asynchron]{Sensor}{MEC-View-Server}
				\end{umlcall}
			\end{umlfragment}
			
			\umlsdnode[dt=11]{Fahrzeug}
			\draw[dashed] (-2,-17) -- (14,-17);
			\draw (9.225,-16.75) node {Fahrzeug trennt die Verbindung};

			\begin{umlcall}[dt=9,op={unsubscribe}, type=asynchron]{MEC-View-Server}{Sensor}
			\end{umlcall}
			
			\begin{umlfragment}[type=loop] 
				\begin{umlcall}[dt=6,op={SensorIdleFrame}, type=asynchron]{Sensor}{MEC-View-Server}
				\end{umlcall}
			\end{umlfragment}
		\end{umlseqdiag}
	\end{tikzpicture}
	\centering
	\caption{Interaktion des MEC-View-Servers mit einem Fahrzeug und einem Sensor}
	\label{seq_dia:both}
\end{figure}
