<!DOCTYPE html>
<html class="js sidebar-visible light" lang="en"><head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Send and Sync - </title>
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="rgb(255, 255, 255)">

        <!-- base href="https://doc.rust-lang.org/beta/nomicon/send-and-sync.html" -->

        <link rel="stylesheet" href="Rusj-Dateien/book.css">
        <link href="Rusj-Dateien/css.css" rel="stylesheet" type="text/css">
        <link href="Rusj-Dateien/css_002.css" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="https://doc.rust-lang.org/beta/nomicon/favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="Rusj-Dateien/font-awesome.css">

        <link rel="stylesheet" href="Rusj-Dateien/highlight.css">
        <link rel="stylesheet" href="Rusj-Dateien/tomorrow-night.css">
        <link rel="stylesheet" href="Rusj-Dateien/ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents" aria-hidden="false">
            <ol class="chapter"><li class="affix"><a href="https://doc.rust-lang.org/beta/nomicon/README.html" tabindex="0">Introduction</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/meet-safe-and-unsafe.html" tabindex="0"><strong aria-hidden="true">1.</strong> Meet Safe and Unsafe</a></li><li><ol class="section"><li><a href="https://doc.rust-lang.org/beta/nomicon/safe-unsafe-meaning.html" tabindex="0"><strong aria-hidden="true">1.1.</strong> How Safe and Unsafe Interact</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/what-unsafe-does.html" tabindex="0"><strong aria-hidden="true">1.2.</strong> What Unsafe Can Do</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/working-with-unsafe.html" tabindex="0"><strong aria-hidden="true">1.3.</strong> Working with Unsafe</a></li></ol></li><li><a href="https://doc.rust-lang.org/beta/nomicon/data.html" tabindex="0"><strong aria-hidden="true">2.</strong> Data Layout</a></li><li><ol class="section"><li><a href="https://doc.rust-lang.org/beta/nomicon/repr-rust.html" tabindex="0"><strong aria-hidden="true">2.1.</strong> repr(Rust)</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/exotic-sizes.html" tabindex="0"><strong aria-hidden="true">2.2.</strong> Exotically Sized Types</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/other-reprs.html" tabindex="0"><strong aria-hidden="true">2.3.</strong> Other reprs</a></li></ol></li><li><a href="https://doc.rust-lang.org/beta/nomicon/ownership.html" tabindex="0"><strong aria-hidden="true">3.</strong> Ownership</a></li><li><ol class="section"><li><a href="https://doc.rust-lang.org/beta/nomicon/references.html" tabindex="0"><strong aria-hidden="true">3.1.</strong> References</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/aliasing.html" tabindex="0"><strong aria-hidden="true">3.2.</strong> Aliasing</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/lifetimes.html" tabindex="0"><strong aria-hidden="true">3.3.</strong> Lifetimes</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/lifetime-mismatch.html" tabindex="0"><strong aria-hidden="true">3.4.</strong> Limits of Lifetimes</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/lifetime-elision.html" tabindex="0"><strong aria-hidden="true">3.5.</strong> Lifetime Elision</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/unbounded-lifetimes.html" tabindex="0"><strong aria-hidden="true">3.6.</strong> Unbounded Lifetimes</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/hrtb.html" tabindex="0"><strong aria-hidden="true">3.7.</strong> Higher-Rank Trait Bounds</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/subtyping.html" tabindex="0"><strong aria-hidden="true">3.8.</strong> Subtyping and Variance</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/dropck.html" tabindex="0"><strong aria-hidden="true">3.9.</strong> Drop Check</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/phantom-data.html" tabindex="0"><strong aria-hidden="true">3.10.</strong> PhantomData</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/borrow-splitting.html" tabindex="0"><strong aria-hidden="true">3.11.</strong> Splitting Borrows</a></li></ol></li><li><a href="https://doc.rust-lang.org/beta/nomicon/conversions.html" tabindex="0"><strong aria-hidden="true">4.</strong> Type Conversions</a></li><li><ol class="section"><li><a href="https://doc.rust-lang.org/beta/nomicon/coercions.html" tabindex="0"><strong aria-hidden="true">4.1.</strong> Coercions</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/dot-operator.html" tabindex="0"><strong aria-hidden="true">4.2.</strong> The Dot Operator</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/casts.html" tabindex="0"><strong aria-hidden="true">4.3.</strong> Casts</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/transmutes.html" tabindex="0"><strong aria-hidden="true">4.4.</strong> Transmutes</a></li></ol></li><li><a href="https://doc.rust-lang.org/beta/nomicon/uninitialized.html" tabindex="0"><strong aria-hidden="true">5.</strong> Uninitialized Memory</a></li><li><ol class="section"><li><a href="https://doc.rust-lang.org/beta/nomicon/checked-uninit.html" tabindex="0"><strong aria-hidden="true">5.1.</strong> Checked</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/drop-flags.html" tabindex="0"><strong aria-hidden="true">5.2.</strong> Drop Flags</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/unchecked-uninit.html" tabindex="0"><strong aria-hidden="true">5.3.</strong> Unchecked</a></li></ol></li><li><a href="https://doc.rust-lang.org/beta/nomicon/obrm.html" tabindex="0"><strong aria-hidden="true">6.</strong> Ownership Based Resource Management</a></li><li><ol class="section"><li><a href="https://doc.rust-lang.org/beta/nomicon/constructors.html" tabindex="0"><strong aria-hidden="true">6.1.</strong> Constructors</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/destructors.html" tabindex="0"><strong aria-hidden="true">6.2.</strong> Destructors</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/leaking.html" tabindex="0"><strong aria-hidden="true">6.3.</strong> Leaking</a></li></ol></li><li><a href="https://doc.rust-lang.org/beta/nomicon/unwinding.html" tabindex="0"><strong aria-hidden="true">7.</strong> Unwinding</a></li><li><ol class="section"><li><a href="https://doc.rust-lang.org/beta/nomicon/exception-safety.html" tabindex="0"><strong aria-hidden="true">7.1.</strong> Exception Safety</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/poisoning.html" tabindex="0"><strong aria-hidden="true">7.2.</strong> Poisoning</a></li></ol></li><li><a href="https://doc.rust-lang.org/beta/nomicon/concurrency.html" tabindex="0"><strong aria-hidden="true">8.</strong> Concurrency</a></li><li><ol class="section"><li><a href="https://doc.rust-lang.org/beta/nomicon/races.html" tabindex="0"><strong aria-hidden="true">8.1.</strong> Races</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/send-and-sync.html" class="active" tabindex="0"><strong aria-hidden="true">8.2.</strong> Send and Sync</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/atomics.html" tabindex="0"><strong aria-hidden="true">8.3.</strong> Atomics</a></li></ol></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec.html" tabindex="0"><strong aria-hidden="true">9.</strong> Implementing Vec</a></li><li><ol class="section"><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-layout.html" tabindex="0"><strong aria-hidden="true">9.1.</strong> Layout</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-alloc.html" tabindex="0"><strong aria-hidden="true">9.2.</strong> Allocating</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-push-pop.html" tabindex="0"><strong aria-hidden="true">9.3.</strong> Push and Pop</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-dealloc.html" tabindex="0"><strong aria-hidden="true">9.4.</strong> Deallocating</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-deref.html" tabindex="0"><strong aria-hidden="true">9.5.</strong> Deref</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-insert-remove.html" tabindex="0"><strong aria-hidden="true">9.6.</strong> Insert and Remove</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-into-iter.html" tabindex="0"><strong aria-hidden="true">9.7.</strong> IntoIter</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-raw.html" tabindex="0"><strong aria-hidden="true">9.8.</strong> RawVec</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-drain.html" tabindex="0"><strong aria-hidden="true">9.9.</strong> Drain</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-zsts.html" tabindex="0"><strong aria-hidden="true">9.10.</strong> Handling Zero-Sized Types</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/vec-final.html" tabindex="0"><strong aria-hidden="true">9.11.</strong> Final Code</a></li></ol></li><li><a href="https://doc.rust-lang.org/beta/nomicon/arc-and-mutex.html" tabindex="0"><strong aria-hidden="true">10.</strong> Implementing Arc and Mutex</a></li><li><a href="https://doc.rust-lang.org/beta/nomicon/ffi.html" tabindex="0"><strong aria-hidden="true">11.</strong> FFI</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar" aria-expanded="true">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title"></h1> 

                        <div class="right-buttons">
                            <a href="https://doc.rust-lang.org/beta/nomicon/print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input name="search" id="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header" type="search">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="https://doc.rust-lang.org/beta/nomicon/send-and-sync.html#send-and-sync" id="send-and-sync"><h1>Send and Sync</h1></a>
<p>Not everything obeys inherited mutability, though. Some types allow you to
have multiple aliases of a location in memory while mutating it. Unless these types use
synchronization to manage this access, they are absolutely not thread-safe. Rust
captures this through the <code class="hljs">Send</code> and <code class="hljs">Sync</code> traits.</p>
<ul>
<li>A type is Send if it is safe to send it to another thread.</li>
<li>A type is Sync if it is safe to share between threads (<code class="hljs">&amp;T</code> is Send).</li>
</ul>
<p>Send and Sync are fundamental to Rust's concurrency story. As such, a
substantial amount of special tooling exists to make them work right. First and
foremost, they're <a href="https://doc.rust-lang.org/beta/nomicon/safe-unsafe-meaning.html">unsafe traits</a>. This means that they are unsafe to
implement, and other unsafe code can assume that they are correctly
implemented. Since they're <em>marker traits</em> (they have no associated items like
methods), correctly implemented simply means that they have the intrinsic
properties an implementor should have. Incorrectly implementing Send or Sync can
cause Undefined Behavior.</p>
<p>Send and Sync are also automatically derived traits. This means that, unlike
every other trait, if a type is composed entirely of Send or Sync types, then it
is Send or Sync. Almost all primitives are Send and Sync, and as a consequence
pretty much all types you'll ever interact with are Send and Sync.</p>
<p>Major exceptions include:</p>
<ul>
<li>raw pointers are neither Send nor Sync (because they have no safety guards).</li>
<li><code class="hljs">UnsafeCell</code> isn't Sync (and therefore <code class="hljs">Cell</code> and <code class="hljs">RefCell</code> aren't).</li>
<li><code class="hljs">Rc</code> isn't Send or Sync (because the refcount is shared and unsynchronized).</li>
</ul>
<p><code class="hljs">Rc</code> and <code class="hljs">UnsafeCell</code> are very fundamentally not thread-safe: they enable
unsynchronized shared mutable state. However raw pointers are, strictly
speaking, marked as thread-unsafe as more of a <em>lint</em>. Doing anything useful
with a raw pointer requires dereferencing it, which is already unsafe. In that
sense, one could argue that it would be "fine" for them to be marked as thread
safe.</p>
<p>However it's important that they aren't thread-safe to prevent types that
contain them from being automatically marked as thread-safe. These types have
non-trivial untracked ownership, and it's unlikely that their author was
necessarily thinking hard about thread safety. In the case of <code class="hljs">Rc</code>, we have a nice
example of a type that contains a <code class="hljs">*mut</code> that is definitely not thread-safe.</p>
<p>Types that aren't automatically derived can simply implement them if desired:</p>
<pre><pre class="playpen"><div class="buttons"><button class="fa fa-copy clip-button" title="Copy to clipboard" aria-label="Copy to clipboard"><i class="tooltiptext"></i></button><button class="fa fa-play play-button" title="Run this code" aria-label="Run this code" hidden=""></button><button class="fa fa-expand" title="Show hidden lines" aria-label="Show hidden lines"></button></div><code class="language-rust hljs"><span class="hidden">
<span class="hljs-meta">#![allow(unused_variables)]</span></span><span class="hidden">
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyBox</span></span>(*<span class="hljs-keyword">mut</span> <span class="hljs-built_in">u8</span>);

<span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">impl</span> <span class="hljs-built_in">Send</span> <span class="hljs-keyword">for</span> MyBox {}
<span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">impl</span> <span class="hljs-built_in">Sync</span> <span class="hljs-keyword">for</span> MyBox {}<span class="hidden">
}</span></code></pre></pre>
<p>In the <em>incredibly rare</em> case that a type is inappropriately automatically
derived to be Send or Sync, then one can also unimplement Send and Sync:</p>
<pre><pre class="playpen"><div class="buttons"><button class="fa fa-copy clip-button" title="Copy to clipboard" aria-label="Copy to clipboard"><i class="tooltiptext"></i></button><button class="fa fa-play play-button" title="Run this code" aria-label="Run this code" hidden=""></button><button class="fa fa-expand" title="Show hidden lines" aria-label="Show hidden lines"></button></div><code class="language-rust hljs"><span class="hidden">
<span class="hljs-meta">#![allow(unused_variables)]</span></span>
<span class="hljs-meta">#![feature(optin_builtin_traits)]</span>
<span class="hidden">
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {</span>
<span class="hljs-comment">// I have some magic semantics for some synchronization primitive!</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SpecialThreadToken</span></span>(<span class="hljs-built_in">u8</span>);

<span class="hljs-keyword">impl</span> !<span class="hljs-built_in">Send</span> <span class="hljs-keyword">for</span> SpecialThreadToken {}
<span class="hljs-keyword">impl</span> !<span class="hljs-built_in">Sync</span> <span class="hljs-keyword">for</span> SpecialThreadToken {}<span class="hidden">
}</span></code></pre></pre>
<p>Note that <em>in and of itself</em> it is impossible to incorrectly derive Send and
Sync. Only types that are ascribed special meaning by other unsafe code can
possible cause trouble by being incorrectly Send or Sync.</p>
<p>Most uses of raw pointers should be encapsulated behind a sufficient abstraction
that Send and Sync can be derived. For instance all of Rust's standard
collections are Send and Sync (when they contain Send and Sync types) in spite
of their pervasive use of raw pointers to manage allocations and complex ownership.
Similarly, most iterators into these collections are Send and Sync because they
largely behave like an <code class="hljs">&amp;</code> or <code class="hljs">&amp;mut</code> into the collection.</p>
<p>TODO: better explain what can or can't be Send or Sync. Sufficient to appeal
only to data races?</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="https://doc.rust-lang.org/beta/nomicon/races.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="https://doc.rust-lang.org/beta/nomicon/atomics.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="https://doc.rust-lang.org/beta/nomicon/races.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="https://doc.rust-lang.org/beta/nomicon/atomics.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        

        
        <script src="Rusj-Dateien/searchindex.js" type="text/javascript" charset="utf-8"></script>
        
        
        <script src="Rusj-Dateien/elasticlunr.js" type="text/javascript" charset="utf-8"></script>
        <script src="Rusj-Dateien/mark.js" type="text/javascript" charset="utf-8"></script>
        <script src="Rusj-Dateien/searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="Rusj-Dateien/clipboard.js" type="text/javascript" charset="utf-8"></script>
        <script src="Rusj-Dateien/highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="Rusj-Dateien/book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

    

</body></html>