

\chapter{Systemanalyse}
\section{Systemkontextdiagramm}



\begin{figure}[H]
	\begin{tikzpicture}[node distance=5]
		\node [draw, rectangle, drop shadow, fill=white] (F) {Fahrzeug};
		\node [draw, circle, drop shadow, fill=white, text width=3cm, align=center] (C) [below right=of F] {Server};
		\node [draw, rectangle, drop shadow, fill=white] (S) [below right=of C] {Sensor};
		\node [draw, rectangle, drop shadow, fill=white] (A) [above right=of C] {Fusions-Algorithmus};
		
		\node (ctrl1) [above=of S] {};
		\node (ctrl2) [above right=of C] {};
		\node (ctrl3) [right=of C] {};
	%	\node (ctrl4) [above right=of S] {};
		\node (ctrl5) [left=of C] {};
		\node (ctrl6) [below=of ctrl5] {};
		
		%
		% Fahrzeug -> Server
		%
		\path[draw, -{Latex[scale=2.0]}, dashed] (F)
				edge [bend right] node [fill=white] {GeoFence verlassen} (C)
				edge [bend left]  node [fill=white] {GeoFence betreten} (C);
				
		%
		% Server -> Fahrzeug
		%
		\path[draw, -{Latex[scale=2.0]}] (C)
				edge node [fill=white] {Fusions-Algorithmus Ergebnis} (F);
				
		%
		% Server -> Algorithmus
		%
		\path[draw, -{Latex[scale=2.0]}] (C)
				edge [bend right] node [fill=white] {Sensordaten} (A);
		
		%
		% Algorithmus -> Server
		%
		\path[draw, -{Latex[scale=2.0]}] (A)
				edge [bend right] node [fill=white] {Ergebnis} (C);
		
		%
		% Sensor -> Server
		%		
		\path[draw, -{Latex[scale=2.0]}, dashed] (S)
			edge [bend left]  node [fill=white] {GeoFence betreten} (C);
		\path[draw, -{Latex[scale=2.0]}] (S)
			edge node [fill=white] {Sensordaten} (C);
				
		%
		% Server -> Fahrzeug
		%
		\path[draw, -{Latex[scale=2.0]}, dashed] (C)
			edge [bend left] node [fill=white] {Wecken} (S)
			.. controls (ctrl1) and (ctrl3) ..  node [fill=white] {Pausieren} (S);
				
				
		
		\path[draw, -{Latex[scale=2.0]}] (4, -8) -- (.5, -8) node [pos=.5, above] {Datenfluss};
		\path[draw, -{Latex[scale=2.0]}, dashed] (4, -9) -- (.5, -9) node [pos=.5, above] {Kontrollfluss};
			
	\end{tikzpicture}
	\centering
	\label{system_context}
	\caption{Systemkontextdiagramm}
\end{figure}

\section{Komponentendiagramm oder sowas?}
\section{Use Case Diagramme}
\todo{was wirklich umgesetzt sein wird}

\begin{figure}[H]
	\begin{tikzpicture}[node distance=5]
		\begin{umlsystem}{Server}
			\umlusecase[y=2,name=u1]{GeoFence betreten}
			\umlusecase[y=0,name=u2]{GeoFence verlassen}
			\umlusecase[y=-2,name=u3]{Sensordaten senden}
			\umlusecase[y=-4,name=u4]{Umfeldmodel übergeben}
		\end{umlsystem}
		\umlactor[x=-6,y=1]{Fahrzeug}
		\umlactor[x=-6,y=-4]{Fusions-Algorithmus}
		\umlactor[x=6,y=1]{Sensor}
		\umlassoc{Fahrzeug}{u1}
		\umlassoc{Fahrzeug}{u2}
		\umlassoc{Sensor}{u1}
		\umlassoc{Sensor}{u3}
		\umlassoc{Fusions-Algorithmus}{u4}
	\end{tikzpicture}
	\centering
	\label{use_case:car}
	\caption{Use Case Diagramm für den Server}
\end{figure}


\begin{figure}[H]
	\begin{tikzpicture}[node distance=5]
		\begin{umlsystem}{Sensor}
			\umlusecase[y=0,name=u1]{Pausieren}
			\umlusecase[y=2,name=u2]{Wecken}
		\end{umlsystem} 
		\umlactor[x=-3.5,y=1]{Server}
		\umlassoc{Server}{u1}
		\umlassoc{Server}{u2} 
	\end{tikzpicture}
	\centering
	\label{use_case:server_sensor}
	\caption{Use Case Diagramm des Servers gegenüber dem Sensor}
\end{figure}

\begin{figure}[H]
	\begin{tikzpicture}[node distance=5]
		\begin{umlsystem}{Fahrzeug}
			\umlusecase[y=0,name=u1]{Umfeldmodell senden}
		\end{umlsystem} 
		\umlactor[x=-5,y=0]{Server}
		\umlassoc{Server}{u1}
	\end{tikzpicture}
	\centering
	\label{use_case:server_vehicle}
	\caption{Use Case Diagramm des Servers gegenüber dem Sensor}
\end{figure}

\begin{figure}[H]
	\begin{tikzpicture}[node distance=5]
		\begin{umlsystem}{Fusions-Algorithmus}
			\umlusecase[y=0,name=u1]{Sensordaten übergeben}
		\end{umlsystem} 
		\umlactor[x=-5,y=0]{Server}
		\umlassoc{Server}{u1}
	\end{tikzpicture}
	\centering
	\label{use_case:server_algorithmus}
	\caption{Use Case Diagramm des Servers gegenüber dem Fusions-Algorithmus}
\end{figure}



\section{Schnitstellenanalyse}
\todo{erwartetes verhalten der sensoren und fahrzeuge}

\begin{figure}[H]
	\begin{tikzpicture}
		\begin{umlseqdiag} 
			\umlobject[x=0,class=Sensor]{c}
			\umlobject[x=9,class=Server]{s}
			\begin{umlcall}[dt=5, op={ASN::RegisterSensor(geofence)}, type=asynchron]{c}{s}
			\end{umlcall}
			\begin{umlfragment}[type=loop] 
				\begin{umlfragment}[type=loop, label=!paused] 
					\begin{umlcall}[dt=5, op={ASN::Detection}, type=asynchron]{c}{s}
					\end{umlcall}
				\end{umlfragment}
				\begin{umlcall}[dt=5, op={ASN::Pause}, type=asynchron]{s}{c}
				\end{umlcall}
				\begin{umlcall}[dt=5, op={ASN::Resume}, type=asynchron]{s}{c}
				\end{umlcall}
			\end{umlfragment}
		\end{umlseqdiag}
	\end{tikzpicture}
	\centering
	\label{seq_dia:_}
	\caption{\todo{Sequenz Diagramm: Anmeldung und Zuweisung zu einem GeoFence eines Sensors}}
\end{figure}