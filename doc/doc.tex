% use koma script classes
% \documentclass[12pt]{scrartcl}
% \documentclass[11pt,a4paper]{article}
%\documentclass[11pt]{scrartcl}
\documentclass[
	12pt,
	table,
	bigheadings,
	ngerman,
	a4paper,
	BCOR5mm,
	DIV14,
	1.1headlines,
	pagesize,
	oneside,
	openright,
	titlepage,
	headsepline,
	nochapterprefix,
	bibtotoc,
	tocindent,
	listsindent,
	pointlessnumbers,
	cleardoubleempty,
	fleqn,
	halfparskip
]{scrbook}
\usepackage[table]{xcolor}


\usepackage[datesep=--,showzoneminutes=false,showzone=false]{datetime2}

\usepackage[T1]{fontenc} 
\usepackage[utf8]{inputenc}

\usepackage{graphicx}
\usepackage{ragged2e}

\usepackage[german]{babel}
\usepackage[autostyle=true,german=quotes]{csquotes}

\usepackage{pgfplots}
\usepackage{ulem}
\usepackage{placeins}
\usepackage{wrapfig}
\usepackage{xcolor}
\usepackage{caption}



\usepackage{tikz}

\usepackage{float}
\usepackage{tabularx}

% required for nicer footer / header
\usepackage[ilines]{scrpage2}

\usepackage[
	backend=biber,
	giveninits=false,
	style=alphabetic,
	uniquename=true,
	doi=true,
	url=false,
	sortcites=true,
	sorting=nyt
]{biblatex}
\usepackage[colorlinks=true]{hyperref}

\addbibresource{sections/asn.bib}
\addbibresource{sections/rust.bib}
\addbibresource{sections/performance.bib}
\addbibresource{general.bib}

%
% git related things
%
\renewcommand{\date}{\ifthenelse{\equal{\gitDirtyValue}{\gitDirty}}{\today}{\printdate{\gitAuthorDate}}}

\newcommand{\gitDirtyValue}{+}
\immediate\write18{/bin/bash update_git_info.sh}
\usepackage[mark,grumpy,dirty=\gitDirtyValue]{gitinfo2}
\immediate\write18{/bin/bash -c "rm .git/gitHeadInfo.gin"}
\renewcommand{\gitMark}{\gitBranch\,@\,\gitAbbrevHash{}
	%\gitReln{} (
	%	\gitAuthorDate
	%)
	%	Head tags: \gitTags
	\textbullet{} \date
}




%\usepackage{listings}             % for code snippets
\usepackage{isodate}
\usepackage{pdfpages} % to include pdfs
\usepackage[acronym,automake,toc]{glossaries}
\setacronymstyle{long-short}  
\usepackage{glossaries-extra}
\usepackage{bytefield}



%required for linebreak inside tabel cells
\usepackage{makecell}

\definecolor{codeBackground}{rgb}{.95,0.95,0.95}

% for color boxes
\usepackage[most]{tcolorbox}

\newcounter{reqNumber}
\setcounter{reqNumber}{1}

\makeatletter
\newcommand{\todo}[1]{\textcolor{red}{TODO: #1}}
\newcommand{\requirement}[3]{\subsection{Anforderung \arabic{reqNumber}: #2}\expandafter\edef\csname#1\endcsname{\arabic{reqNumber}}\label{req:#1}\stepcounter{reqNumber} #3}
\newcommand{\reqNumberForLabel}[1]{\@nameuse{#1}}

\newcommand{\captionsource}[1]{\caption*{\footnotesize{Quelle: #1}}}
\makeatother


\input{config.fonts.tex}
\input{config.autoref.tex}
\input{config.listing.tex}
\input{config.tikz.tex}
\input{config.bibtex.tex}

\include{gloassary}
\include{acronym}

\glsaddall
\makeglossaries

\defglsdisplayfirst[main]{\glsentryname{\glslabel}\protect\footnote{\glsentrydesc{\glslabel}}}

	
\begin{document}
	\sloppy
	
	\pagenumbering{roman}
	\setcounter{page}{0}
	
	\include{titlepage}
	\include{legal}
	\include{declaration}
	\include{thanks}
	\include{fancy_quote}
	
	\thispagestyle{empty}
	
	
	\clearpage	
	\hypersetup{allcolors=black}
	\tableofcontents
	\hypersetup{allcolors=blue}
	\newpage
	
	
	\pagenumbering{arabic}
	\setcounter{page}{1}
	
	\include{sections/intro}
	\include{sections/rust}
	\input{sections/performance}
		
%	\chapter{Aufgabenstellung}
	
%	\todo{mec-view server}
	
%	\todo{rust}
	
	
	\input{sections/requirements}
	\input{sections/analysis}
	
		
	\chapter{Systementwurf}
		\section{Architektur / Komponentendiagramme}
		\begin{figure}[H]
			\centering
			\begin{tikzpicture}
				\begin{umlcomponent}{MEC-Server}
					\umlbasiccomponent[x=3,y=4]{Server}
					\umlprovidedinterface[interface=TcpListener]{Server}
					
					
					\umlbasiccomponent[x=9,y=5]{Fusions-Algorithmus}
%					\umlbasiccomponent[x=1,y=5]{Sektor-Abonnement}
					\umlbasiccomponent[x=6,y=0]{Client-Connection}
					
					\umlHVassemblyconnector[interface=FaQ,arm2=-2]{Client-Connection}{Fusions-Algorithmus}
%					\umlHVassemblyconnector[interface=SaQ,arm2=-2]{Client-Connection}{Sektor-Abonnement}
					
					\umlHVassemblyconnector[interface=CQ,last arm]{Fusions-Algorithmus}{Client-Connection}
					\umlHVassemblyconnector[last arm]{Server}{Client-Connection}
%					\umlHVassemblyconnector[last arm]{Sektor-Abonnement}{Client-Connection}
				\end{umlcomponent}
				\umlHVHdelegateconnector{MEC-Server-west-port}{Server-west-interface}
				\umlport{MEC-Server}{west}
			\end{tikzpicture} 
		\end{figure}
		  
		\todo{Component diagrams tikz-uml: server, algorithm, encoder/...}		
		
		\section{Sequenzdiagramme}
		
		\subsection{Low-Latency + Entwurfsmuster + Patterns? + Algorithmen?}
		\todo{Hochperformant -> parallel?}
		
		\todo{Design Pattern, Gamma et al, four important aspects}
		
		\todo{Real Time Design Patterns Buch: Ab Seite 141, verschiedene Systempatterns, microkernel \cite[151]{douglass2003real}? channel architektur pattern \cite[167]{douglass2003real}?}
		
		\todo{Message Queuing Pattern \cite[207]{douglass2003real}}
		
		\todo{kein hartes Echtzeitsystem, gerade mal weiches Echtzeitsystem \autoref{real_time_system}}
		
		\todo{Clean Architecture / Clean Code}
	
	\chapter{Implementierung}
	
	\todo{rust-clippy: https://github.com/rust-lang-nursery/rust-clippy}
	
	\todo{catch panic? mention how in \autoref{rust:no_null}}
	
	\todo{SRP, impl Object separat from impl CommandProcessor for Object, testability?}
	
	\subsection{Tokio}
	
		\subsection{Generalisierung mittels Aufzählung für nicht erweiterbare Anzahl von Elementen}
		
		\subsection{libmessages make unsafe libmessages-sys safe}
		
		\subsection{Vorgehen, bindgen tests, C/unsafe/wrapper -> nach sicher ->  architektur entwickeln}
		
		\subsection{Architektur zeigen, module/crates, }
	
		\subsection{TDD?}
		\todo{Learning Test p.136 for tokio?}
		\subsection{Unerwartete Schwierigkeiten}
		\label{impl:issue:ffi}
			\todo{Schwierigkeiten: FFI binding, manuell -> meh, also generieren}
			
			
	\chapter{Auswertung}
	
	\chapter{Zusammenfassung und Fazit}
	
	
	
	\pagenumbering{Roman}
	
	\clearpage
	\normalem
	\printbibliography
	
	\clearpage
	\deftranslation{Acronyms}{Abkürzungsverzeichnis} 
	\printglossary[type=\acronymtype]

	\clearpage
	\addcontentsline{toc}{chapter}{\listfigurename}
	\listoffigures
	\lstlistoflistings
	
	
\end{document}